services:
  rlvr:
    build:
      context: .
      dockerfile: docker/Dockerfile
    container_name: rlvr-dev
    working_dir: /workspace
    stdin_open: true
    tty: true

    # Persistent mounts: code, venv, uv cache
    volumes:
      - .:/workspace:cached
      - rlvr-venv:/workspace/.venv
      - rlvr-uvcache:/root/.cache/uv

    env_file:
      - .env

    environment:
      # Make both src/ and repo root importable
      PYTHONPATH: "/workspace:/workspace/src"
      DAFNY_PATH: "/opt/dafny/dafny"
      HF_HOME: "/workspace/.cache/huggingface"

    command: bash

volumes:
  rlvr-venv:
  rlvr-uvcache:
